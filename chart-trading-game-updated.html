<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ˆ Chart Trading Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .money {
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease-out;
        }
        
        .profit {
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s ease-out;
        }
        
        .profit.positive {
            color: #4ade80;
        }
        
        .profit.negative {
            color: #f87171;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            height: 250px;
            position: relative;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
            transition: all 0.1s ease-out;
        }
        
        .time-level-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .timer {
            font-size: 20px;
            font-weight: bold;
        }
        
        .level {
            font-size: 14px;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-buy {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
        }
        
        .btn-buy:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }
        
        .btn-sell {
            background: linear-gradient(135deg, #f87171, #ef4444);
            color: white;
        }
        
        .btn-sell:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }
        
        .leaderboard-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .leaderboard-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            color: black;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 350px;
            width: 90%;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .modal-result {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .name-input {
            width: 120px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            margin: 10px;
        }
        
        .restart-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        
        .leaderboard-list {
            text-align: left;
            margin: 20px 0;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        
        .rank {
            font-weight: bold;
            width: 30px;
        }
        
        .rank.gold { color: #ffd700; }
        .rank.silver { color: #c0c0c0; }
        .rank.bronze { color: #cd7f32; }
        
        .player-name {
            font-weight: bold;
            font-family: monospace;
            font-size: 16px;
        }
        
        .score {
            font-weight: bold;
            color: #4ade80;
        }
        
        .new-record {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            color: #000;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .start-screen {
            text-align: center;
        }
        
        .start-title {
            font-size: 28px;
            margin-bottom: 20px;
        }
        
        .start-description {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 30px;
            line-height: 1.4;
        }
        
        .start-button {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ì‹œì‘ í™”ë©´ -->
        <div class="start-screen" id="startScreen">
            <h1 class="start-title">ğŸ“ˆ Chart Trading Game</h1>
            <p class="start-description">
                45ì´ˆ ë™ì•ˆ ì°¨íŠ¸ë¥¼ ë³´ê³  ë§¤ìˆ˜/ë§¤ë„ë¡œ ìµœëŒ€í•œ ë§ì€ ìˆ˜ìµì„ ë‚´ë³´ì„¸ìš”!<br>
                ì „ëŸ‰ ê±°ë˜ë¡œ ìŠ¤ë¦´ ë„˜ì¹˜ëŠ” íŠ¸ë ˆì´ë”©ì„ ê²½í—˜í•˜ì„¸ìš”!
            </p>
            <button class="start-button" onclick="startNewGame()">ğŸš€ ê²Œì„ ì‹œì‘</button>
            <button class="leaderboard-btn" onclick="showLeaderboard()">ğŸ† ë¦¬ë”ë³´ë“œ</button>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div id="gameScreen" style="display: none;">
            <!-- ìƒíƒœë°” -->
            <div class="status-bar">
                <div class="money">ğŸ’° $<span id="currentMoney">10000</span></div>
                <div class="profit" id="profitDisplay">ğŸ“ˆ 0%</div>
            </div>
            
            <!-- ì°¨íŠ¸ ì˜ì—­ -->
            <div class="chart-container">
                <canvas id="chartCanvas" class="chart-canvas"></canvas>
            </div>
            
            <!-- ì‹œê°„/ë ˆë²¨ ë°” -->
            <div class="time-level-bar">
                <div class="timer">â° <span id="timeDisplay">00:45</span></div>
                <div class="level">ğŸ¯ Round <span id="roundDisplay">1</span></div>
            </div>
            
            <!-- ì¡°ì‘ ë²„íŠ¼ -->
            <div class="control-buttons">
                <button class="btn btn-buy" id="buyBtn">ğŸ“ˆ BUY</button>
                <button class="btn btn-sell" id="sellBtn" disabled>ğŸ“‰ SELL</button>
            </div>
            
            <button class="leaderboard-btn" onclick="showLeaderboard()">ğŸ† ë¦¬ë”ë³´ë“œ ë³´ê¸°</button>
        </div>
    </div>
    
    <!-- ê²Œì„ ì˜¤ë²„ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="gameOverScreen">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ® ë¼ìš´ë“œ ì™„ë£Œ!</h2>
            <p class="modal-result" id="finalResult"></p>
            <div id="newRecordSection" style="display: none;">
                <p style="color: #ffd700; font-weight: bold; margin: 15px 0;">ğŸ‰ ë¦¬ë”ë³´ë“œ ì§„ì…!</p>
                <input type="text" class="name-input" id="playerNameInput" placeholder="ABC" maxlength="3">
                <p style="font-size: 12px; color: #666;">ì˜ë¬¸ 3ê¸€ìë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            </div>
            <button class="restart-btn" onclick="handleGameOver()">ğŸ”„ ë‹¤ìŒ ë¼ìš´ë“œ</button>
            <button class="restart-btn" onclick="showLeaderboard()" style="background: #6366f1;">ğŸ† ë¦¬ë”ë³´ë“œ</button>
        </div>
    </div>

    <!-- ë¦¬ë”ë³´ë“œ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="leaderboardScreen">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ† ë¦¬ë”ë³´ë“œ</h2>
            <div class="leaderboard-list" id="leaderboardList">
                <!-- ë¦¬ë”ë³´ë“œ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
            <button class="restart-btn" onclick="hideLeaderboard()">ëŒì•„ê°€ê¸°</button>
            <button class="restart-btn" onclick="clearLeaderboard()" style="background: #ef4444;">ê¸°ë¡ ì´ˆê¸°í™”</button>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            cash: 10000,
            stocks: 0,
            stockPrice: 100,
            timeLeft: 45,
            round: 1,
            gameRunning: false,
            chartData: [],
            maxTime: 45,
            // ì°¨íŠ¸ ìŠ¤ì¼€ì¼ ë¶€ë“œëŸ¬ìš´ ë³€í™”ë¥¼ ìœ„í•œ ë³€ìˆ˜
            currentMinPrice: 90,
            currentMaxPrice: 110,
            targetMinPrice: 90,
            targetMaxPrice: 110
        };
        
        // DOM ìš”ì†Œ
        const canvas = document.getElementById('chartCanvas');
        const ctx = canvas.getContext('2d');
        const currentMoneyEl = document.getElementById('currentMoney');
        const profitDisplayEl = document.getElementById('profitDisplay');
        const timeDisplayEl = document.getElementById('timeDisplay');
        const roundDisplayEl = document.getElementById('roundDisplay');
        const buyBtn = document.getElementById('buyBtn');
        const sellBtn = document.getElementById('sellBtn');
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const leaderboardScreen = document.getElementById('leaderboardScreen');
        
        // ë¦¬ë”ë³´ë“œ ê´€ë¦¬
        function getLeaderboard() {
            const saved = localStorage.getItem('chartGameLeaderboard');
            return saved ? JSON.parse(saved) : [];
        }
        
        function saveLeaderboard(leaderboard) {
            localStorage.setItem('chartGameLeaderboard', JSON.stringify(leaderboard));
        }
        
        function addToLeaderboard(name, score) {
            const leaderboard = getLeaderboard();
            leaderboard.push({ name: name.toUpperCase(), score: Math.round(score) });
            leaderboard.sort((a, b) => b.score - a.score);
            const top10 = leaderboard.slice(0, 10);
            saveLeaderboard(top10);
            return top10;
        }
        
        function isHighScore(score) {
            const leaderboard = getLeaderboard();
            return leaderboard.length < 10 || score > (leaderboard[9]?.score || 0);
        }
        
        function showLeaderboard() {
            const leaderboard = getLeaderboard();
            const listEl = document.getElementById('leaderboardList');
            
            if (leaderboard.length === 0) {
                listEl.innerHTML = '<p style="text-align: center; color: #666;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            } else {
                listEl.innerHTML = leaderboard.map((entry, index) => {
                    const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                    const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : '';
                    return `
                        <div class="leaderboard-item">
                            <span class="rank ${rankClass}">${medal}${index + 1}</span>
                            <span class="player-name">${entry.name}</span>
                            <span class="score">$${entry.score.toLocaleString()}</span>
                        </div>
                    `;
                }).join('');
            }
            
            leaderboardScreen.style.display = 'flex';
        }
        
        function hideLeaderboard() {
            leaderboardScreen.style.display = 'none';
        }
        
        function clearLeaderboard() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('chartGameLeaderboard');
                showLeaderboard();
            }
        }
        
        // Canvas í¬ê¸° ì„¤ì •
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = container.clientHeight - 40;
        }
        
        // ê²Œì„ ì‹œì‘
        function startNewGame() {
            window.tickCount = 0;
            gameState = {
                cash: 10000,
                stocks: 0,
                stockPrice: 100,
                timeLeft: 45,
                round: gameState.round,
                gameRunning: true,
                chartData: [{price: 100, time: 0}],
                maxTime: 45,
                currentMinPrice: 90,
                currentMaxPrice: 110,
                targetMinPrice: 90,
                targetMaxPrice: 110
            };
            
            startScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            gameOverScreen.style.display = 'none';
            updateUI();
            resizeCanvas();
            
            // ê²Œì„ íƒ€ì´ë¨¸ ì‹œì‘ (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ 100msë§ˆë‹¤ ì—…ë°ì´íŠ¸)
            const gameTimer = setInterval(() => {
                if (!gameState.gameRunning) {
                    clearInterval(gameTimer);
                    return;
                }
                
                window.tickCount++;
                
                // 100msë§ˆë‹¤ ì‘ì€ ì£¼ê°€ ë³€ë™
                const smallChange = (Math.random() - 0.5) * 1.2;
                gameState.stockPrice = Math.max(10, gameState.stockPrice + smallChange);
                
                // ì°¨íŠ¸ ìŠ¤ì¼€ì¼ ë¶€ë“œëŸ¬ìš´ ì—…ë°ì´íŠ¸
                updateChartScale();
                
                // 1ì´ˆë§ˆë‹¤ (10í‹±ë§ˆë‹¤) ì‹œê°„ ê°ì†Œ ë° ì°¨íŠ¸ ë°ì´í„° ì¶”ê°€
                if (window.tickCount % 10 === 0) {
                    gameState.timeLeft--;
                    gameState.chartData.push({
                        price: gameState.stockPrice,
                        time: gameState.maxTime - gameState.timeLeft
                    });
                }
                
                updateUI();
                drawChart();
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 100);
        }
        
        // ì°¨íŠ¸ ìŠ¤ì¼€ì¼ ë¶€ë“œëŸ¬ìš´ ì—…ë°ì´íŠ¸
        function updateChartScale() {
            const prices = [...gameState.chartData.map(d => d.price), gameState.stockPrice];
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice;
            
            // í˜„ì¬ ìŠ¤ì¼€ì¼ì—ì„œ ë²—ì–´ë‚˜ëŠ” ì •ë„ ì²´í¬ (15% ì„ê³„ì )
            const currentRange = gameState.currentMaxPrice - gameState.currentMinPrice;
            const minThreshold = gameState.currentMinPrice + currentRange * 0.15;
            const maxThreshold = gameState.currentMaxPrice - currentRange * 0.15;
            
            // ì„ê³„ì ì„ ë„˜ìœ¼ë©´ ìƒˆë¡œìš´ íƒ€ê²Ÿ ìŠ¤ì¼€ì¼ ì„¤ì •
            if (minPrice < minThreshold || maxPrice > maxThreshold) {
                const padding = Math.max(priceRange * 0.1, 5);
                gameState.targetMinPrice = minPrice - padding;
                gameState.targetMaxPrice = maxPrice + padding;
            }
            
            // í˜„ì¬ ìŠ¤ì¼€ì¼ì„ íƒ€ê²Ÿìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™ (5% ë¹„ìœ¨)
            const lerpRate = 0.05;
            gameState.currentMinPrice += (gameState.targetMinPrice - gameState.currentMinPrice) * lerpRate;
            gameState.currentMaxPrice += (gameState.targetMaxPrice - gameState.currentMaxPrice) * lerpRate;
        }
        
        // ì‹¤ì‹œê°„ ì°¨íŠ¸ ë°ì´í„° (ë§¤ 100msë§ˆë‹¤ ì—…ë°ì´íŠ¸)
        let realtimeData = [];
        
        // ì°¨íŠ¸ ê·¸ë¦¬ê¸° (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ë²„ì „)
        function drawChart() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ (í˜„ì¬ ê°€ê²©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ê°€)
            const currentTime = gameState.maxTime - gameState.timeLeft + (window.tickCount % 10) * 0.1;
            realtimeData = [...gameState.chartData, {price: gameState.stockPrice, time: currentTime}];
            
            if (realtimeData.length < 2) return;
            
            const padding = 20;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            
            // ë¶€ë“œëŸ¬ìš´ ìŠ¤ì¼€ì¼ ì‚¬ìš©
            const priceRange = gameState.currentMaxPrice - gameState.currentMinPrice;
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸° (ë¶€ë“œëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜)
            const gradient = ctx.createLinearGradient(0, padding, 0, canvas.height - padding);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.05)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0.1)');
            
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // ë¶€ë“œëŸ¬ìš´ ê³¡ì„  ë¼ì¸ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#4ade80';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.beginPath();
            
            // ë² ì§€ì–´ ê³¡ì„ ì„ ì‚¬ìš©í•œ ë¶€ë“œëŸ¬ìš´ ë¼ì¸
            realtimeData.forEach((point, index) => {
                const x = padding + (chartWidth / gameState.maxTime) * point.time;
                const y = padding + chartHeight - ((point.price - gameState.currentMinPrice) / priceRange) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else if (index === 1) {
                    ctx.lineTo(x, y);
                } else {
                    // ë¶€ë“œëŸ¬ìš´ ê³¡ì„ ì„ ìœ„í•œ ë² ì§€ì–´ ê³¡ì„ 
                    const prevPoint = realtimeData[index - 1];
                    const prevX = padding + (chartWidth / gameState.maxTime) * prevPoint.time;
                    const prevY = padding + chartHeight - ((prevPoint.price - gameState.currentMinPrice) / priceRange) * chartHeight;
                    
                    const cpX = (prevX + x) / 2;
                    ctx.quadraticCurveTo(cpX, prevY, x, y);
                }
            });
            
            ctx.stroke();
            
            // í˜„ì¬ ê°€ê²© í¬ì¸íŠ¸ (í„ìŠ¤ íš¨ê³¼)
            if (realtimeData.length > 0) {
                const lastPoint = realtimeData[realtimeData.length - 1];
                const x = padding + (chartWidth / gameState.maxTime) * lastPoint.time;
                const y = padding + chartHeight - ((lastPoint.price - gameState.currentMinPrice) / priceRange) * chartHeight;
                
                // í„ìŠ¤ íš¨ê³¼ë¥¼ ìœ„í•œ ì• ë‹ˆë©”ì´ì…˜
                const pulseSize = 3 + Math.sin(Date.now() * 0.01) * 2;
                
                // ì™¸ê³½ ì› (í„ìŠ¤)
                ctx.fillStyle = 'rgba(74, 222, 128, 0.3)';
                ctx.beginPath();
                ctx.arc(x, y, pulseSize + 3, 0, Math.PI * 2);
                ctx.fill();
                
                // ë‚´ë¶€ ì›
                ctx.fillStyle = '#4ade80';
                ctx.beginPath();
                ctx.arc(x, y, pulseSize, 0, Math.PI * 2);
                ctx.fill();
                
                // ê°€ê²© í…ìŠ¤íŠ¸ (ê·¸ë¦¼ì íš¨ê³¼)
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 4;
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px -apple-system';
                ctx.fillText(`$${lastPoint.price.toFixed(1)}`, x + 15, y - 10);
                ctx.shadowBlur = 0;
            }
        }
        
        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            const totalValue = gameState.cash + (gameState.stocks * gameState.stockPrice);
            const profit = ((totalValue - 10000) / 10000) * 100;
            
            currentMoneyEl.textContent = Math.round(totalValue);
            
            profitDisplayEl.textContent = `${profit >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${profit.toFixed(1)}%`;
            profitDisplayEl.className = `profit ${profit >= 0 ? 'positive' : 'negative'}`;
            
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            timeDisplayEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            roundDisplayEl.textContent = gameState.round;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            buyBtn.disabled = gameState.cash < gameState.stockPrice || !gameState.gameRunning;
            sellBtn.disabled = gameState.stocks === 0 || !gameState.gameRunning;
        }
        
        // ë§¤ìˆ˜ í•¨ìˆ˜
        function buyStock() {
            if (gameState.cash >= gameState.stockPrice && gameState.gameRunning) {
                const stocksToBuy = Math.floor(gameState.cash / gameState.stockPrice);
                gameState.stocks += stocksToBuy;
                gameState.cash -= stocksToBuy * gameState.stockPrice;
                updateUI();
            }
        }
        
        // ë§¤ë„ í•¨ìˆ˜
        function sellStock() {
            if (gameState.stocks > 0 && gameState.gameRunning) {
                gameState.cash += gameState.stocks * gameState.stockPrice;
                gameState.stocks = 0;
                updateUI();
            }
        }
        
        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            gameState.gameRunning = false;
            
            const totalValue = gameState.cash + (gameState.stocks * gameState.stockPrice);
            const profit = totalValue - 10000;
            const profitPercent = (profit / 10000) * 100;
            
            let message = '';
            if (profitPercent > 50) {
                message = `ğŸ‰ Amazing! +${profitPercent.toFixed(1)}%`;
            } else if (profitPercent > 20) {
                message = `ğŸ”¥ Excellent! +${profitPercent.toFixed(1)}%`;
            } else if (profitPercent > 0) {
                message = `ğŸ‘ Good job! +${profitPercent.toFixed(1)}%`;
            } else if (profitPercent > -10) {
                message = `ğŸ˜ Not bad! ${profitPercent.toFixed(1)}%`;
            } else {
                message = `ğŸ˜… Try again! ${profitPercent.toFixed(1)}%`;
            }
            
            document.getElementById('finalResult').textContent = message;
            
            // ë¦¬ë”ë³´ë“œ ì²´í¬
            if (isHighScore(totalValue)) {
                document.getElementById('newRecordSection').style.display = 'block';
                document.getElementById('playerNameInput').value = '';
                document.getElementById('playerNameInput').focus();
            } else {
                document.getElementById('newRecordSection').style.display = 'none';
            }
            
            gameState.round++;
            gameOverScreen.style.display = 'flex';
        }
        
        // ê²Œì„ ì˜¤ë²„ ì²˜ë¦¬
        function handleGameOver() {
            const newRecordSection = document.getElementById('newRecordSection');
            const nameInput = document.getElementById('playerNameInput');
            
            if (newRecordSection.style.display !== 'none') {
                const playerName = nameInput.value.trim();
                if (playerName.length !== 3) {
                    alert('ì˜ë¬¸ 3ê¸€ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    nameInput.focus();
                    return;
                }
                
                const totalValue = gameState.cash + (gameState.stocks * gameState.stockPrice);
                addToLeaderboard(playerName, totalValue);
            }
            
            gameOverScreen.style.display = 'none';
            startScreen.style.display = 'block';
            gameScreen.style.display = 'none';
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        buyBtn.addEventListener('click', buyStock);
        sellBtn.addEventListener('click', sellStock);
        window.addEventListener('resize', resizeCanvas);
        
        // ì—”í„°í‚¤ë¡œ ì´ë¦„ ì…ë ¥ ì™„ë£Œ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('newRecordSection').style.display !== 'none') {
                handleGameOver();
            }
        });
        
        // ì´ë¦„ ì…ë ¥ í•„í„°ë§ (ì˜ë¬¸ë§Œ)
        document.getElementById('playerNameInput').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^A-Za-z]/g, '').toUpperCase();
        });
        
        // ì´ˆê¸°í™”
        resizeCanvas();
    </script>
</body>
</html>