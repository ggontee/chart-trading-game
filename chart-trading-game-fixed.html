<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ˆ Chart Trading Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .money {
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease-out;
        }
        
        .profit {
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s ease-out;
        }
        
        .profit.positive {
            color: #4ade80;
        }
        
        .profit.negative {
            color: #f87171;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            height: 250px;
            position: relative;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
            transition: all 0.1s ease-out;
        }
        
        .time-level-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .timer {
            font-size: 20px;
            font-weight: bold;
        }
        
        .level {
            font-size: 14px;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-buy {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
        }
        
        .btn-buy:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }
        
        .btn-sell {
            background: linear-gradient(135deg, #f87171, #ef4444);
            color: white;
        }
        
        .btn-sell:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }
        
        .leaderboard-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .leaderboard-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            color: black;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 380px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .modal-result {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .advice-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .advice-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pattern-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 8px;
        }
        
        .advice-text {
            font-size: 15px;
            line-height: 1.4;
            font-style: italic;
            color: #2c3e50;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        
        .name-input {
            width: 120px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            margin: 10px;
        }
        
        .restart-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        
        .leaderboard-list {
            text-align: left;
            margin: 20px 0;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .leaderboard-item:last-child {
            border-bottom: none;
        }
        
        .rank {
            font-weight: bold;
            width: 30px;
        }
        
        .rank.gold { color: #ffd700; }
        .rank.silver { color: #c0c0c0; }
        .rank.bronze { color: #cd7f32; }
        
        .player-name {
            font-weight: bold;
            font-family: monospace;
            font-size: 16px;
        }
        
        .score {
            font-weight: bold;
            color: #4ade80;
        }
        
        .new-record {
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            color: #000;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .start-screen {
            text-align: center;
        }
        
        .start-title {
            font-size: 28px;
            margin-bottom: 20px;
        }
        
        .start-description {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 30px;
            line-height: 1.4;
        }
        
        .start-button {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }

        .flow-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ì‹œì‘ í™”ë©´ -->
        <div class="start-screen" id="startScreen">
            <h1 class="start-title">ğŸ“ˆ Chart Trading Game</h1>
            <p class="start-description">
                45ì´ˆ ë™ì•ˆ ì°¨íŠ¸ë¥¼ ë³´ê³  ë§¤ìˆ˜/ë§¤ë„ë¡œ ìµœëŒ€í•œ ë§ì€ ìˆ˜ìµì„ ë‚´ë³´ì„¸ìš”!<br>
                ë‹¹ì‹ ì˜ ë§¤ë§¤ íŒ¨í„´ì„ ë¶„ì„í•´ì„œ ë§ì¶¤ íˆ¬ì ì¡°ì–¸ì„ ì œê³µí•©ë‹ˆë‹¤!
            </p>
            <button class="start-button" onclick="startNewGame()">ğŸš€ ê²Œì„ ì‹œì‘</button>
            <button class="leaderboard-btn" onclick="showLeaderboard()">ğŸ† ë¦¬ë”ë³´ë“œ</button>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div id="gameScreen" style="display: none;">
            <!-- ìƒíƒœë°” -->
            <div class="status-bar">
                <div class="money">ğŸ’° $<span id="currentMoney">10000</span></div>
                <div class="profit" id="profitDisplay">ğŸ“ˆ 0%</div>
            </div>
            
            <!-- ì°¨íŠ¸ ì˜ì—­ -->
            <div class="chart-container">
                <canvas id="chartCanvas" class="chart-canvas"></canvas>
            </div>
            
            <!-- ì‹œê°„/ë ˆë²¨ ë°” -->
            <div class="time-level-bar">
                <div class="timer">â° <span id="timeDisplay">00:45</span></div>
                <div class="level">ğŸ¯ Round <span id="roundDisplay">1</span></div>
            </div>
            
            <!-- ì¡°ì‘ ë²„íŠ¼ -->
            <div class="control-buttons">
                <button class="btn btn-buy" id="buyBtn">ğŸ“ˆ BUY</button>
                <button class="btn btn-sell" id="sellBtn" disabled>ğŸ“‰ SELL</button>
            </div>
            
            <button class="leaderboard-btn" onclick="showLeaderboard()">ğŸ† ë¦¬ë”ë³´ë“œ ë³´ê¸°</button>
        </div>
    </div>
    
    <!-- ê²Œì„ ì˜¤ë²„ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="gameOverScreen">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ® ê²Œì„ ì™„ë£Œ!</h2>
            <p class="modal-result" id="finalResult"></p>
            
            <!-- íˆ¬ì ì¡°ì–¸ ì„¹ì…˜ -->
            <div class="advice-section" id="adviceSection">
                <div class="advice-title" id="adviceTitle">
                    <span id="patternIcon"></span>
                    <span id="patternText"></span>
                </div>
                <div class="pattern-info" id="patternInfo"></div>
                <div class="advice-text" id="adviceText"></div>
            </div>
            
            <div id="newRecordSection" style="display: none;">
                <p style="color: #ffd700; font-weight: bold; margin: 15px 0;">ğŸ‰ ë¦¬ë”ë³´ë“œ ì§„ì…!</p>
                <input type="text" class="name-input" id="playerNameInput" placeholder="ABC" maxlength="3">
                <p style="font-size: 12px; color: #666;">ì˜ë¬¸ 3ê¸€ìë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            </div>
            
            <div class="flow-buttons">
                <button class="restart-btn" onclick="handleGameOver()">ë‹¤ìŒ ë‹¨ê³„</button>
            </div>
        </div>
    </div>

    <!-- ë¦¬ë”ë³´ë“œ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="leaderboardScreen">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ† ë¦¬ë”ë³´ë“œ</h2>
            <div class="leaderboard-list" id="leaderboardList">
                <!-- ë¦¬ë”ë³´ë“œ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
            <div class="flow-buttons">
                <button class="restart-btn" onclick="restartFromLeaderboard()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
                <button class="restart-btn" onclick="clearLeaderboard()" style="background: #ef4444;">ê¸°ë¡ ì´ˆê¸°í™”</button>
            </div>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            cash: 10000,
            stocks: 0,
            stockPrice: 100,
            timeLeft: 45,
            round: 1,
            gameRunning: false,
            chartData: [],
            maxTime: 45,
            // ì°¨íŠ¸ ìŠ¤ì¼€ì¼ ë¶€ë“œëŸ¬ìš´ ë³€í™”ë¥¼ ìœ„í•œ ë³€ìˆ˜
            currentMinPrice: 90,
            currentMaxPrice: 110,
            targetMinPrice: 90,
            targetMaxPrice: 110,
            // ë§¤ë§¤ ì¶”ì  ë³€ìˆ˜
            trades: [],
            priceHistory: [],
            currentPosition: 'cash' // 'cash' or 'stocks'
        };
        
        // íˆ¬ì ì¡°ì–¸ ë§¤íŠ¸ë¦­ìŠ¤
        const adviceMatrix = {
            // ëŒ€ì„±ê³µ (+30% ì´ìƒ)
            'excellent': {
                'patient': { 
                    icon: 'ğŸ¯', 
                    pattern: 'ì¸ë‚´í˜• íˆ¬ìì',
                    info: 'ë§¤ë§¤ íšŸìˆ˜ê°€ ì ê³  ì¥ê¸° ë³´ìœ ë¥¼ ì„ í˜¸í•˜ëŠ” ìŠ¤íƒ€ì¼',
                    advice: '"ì‹œê°„ì´ ë³µë¦¬ì˜ ë§ˆë²•ì„ ë§Œë“ ë‹¤." - ì¸ë‚´ì‹¬ ìˆëŠ” ë‹¹ì‹ ì˜ íˆ¬ìëŠ” ì›Œë Œ ë²„í•ë„ ì¸ì •í•  ê²ë‹ˆë‹¤!' 
                },
                'active': { 
                    icon: 'âš¡', 
                    pattern: 'ì•¡í‹°ë¸Œ íŠ¸ë ˆì´ë”',
                    info: 'í™œë°œí•œ ë§¤ë§¤ë¡œ ë†’ì€ ìˆ˜ìµì„ ë‹¬ì„±í•œ ìŠ¤íƒ€ì¼',
                    advice: '"ì‹¤ë ¥ì¸ê°€, ìš´ì¸ê°€?" - ë›°ì–´ë‚œ ìˆ˜ìµì´ì§€ë§Œ ìˆ˜ìˆ˜ë£Œì™€ ì„¸ê¸ˆì„ ê³ ë ¤í•´ë³´ì„¸ìš”!' 
                },
                'emotional': { 
                    icon: 'ğŸ²', 
                    pattern: 'ì§ê°í˜• íˆ¬ìì',
                    info: 'ì‹œì¥ ë³€í™”ì— ì¦‰ê° ë°˜ì‘í•˜ëŠ” ë§¤ë§¤ ìŠ¤íƒ€ì¼',
                    advice: '"ì§ê°ì´ í†µí–ˆë„¤ìš”!" - í•˜ì§€ë§Œ í•­ìƒ í†µí• ê¹Œìš”? ì „ëµì  ì ‘ê·¼ì„ ë³‘í–‰í•´ë³´ì„¸ìš”!' 
                },
                'cautious': { 
                    icon: 'ğŸŒ', 
                    pattern: 'ì‹ ì¤‘í˜• íˆ¬ìì',
                    info: 'íƒ€ì´ë°ì„ ì‹ ì¤‘íˆ ê³ ë ¤í•œ ë§¤ë§¤ ìŠ¤íƒ€ì¼',
                    advice: '"ì‹ ì¤‘í•¨ê³¼ íƒ€ì´ë°, ì„±ê³µ íˆ¬ìì˜ í™©ê¸ˆì¡°í•©ì…ë‹ˆë‹¤!" - ê³„ì† ì´ëŸ° ìŠ¤íƒ€ì¼ì„ ìœ ì§€í•˜ì„¸ìš”!' 
                },
                'overactive': { 
                    icon: 'ğŸª', 
                    pattern: 'ì´ˆí™œì„± íŠ¸ë ˆì´ë”',
                    info: 'ë§¤ìš° ì¦ì€ ë§¤ë§¤ë¡œ ìˆ˜ìµì„ ì¶”êµ¬í•˜ëŠ” ìŠ¤íƒ€ì¼',
                    advice: '"ê³¼ë„í•œ ë§¤ë§¤ì—ë„ ìˆ˜ìµì´ë¼ë‹ˆ!" - ìˆ˜ìˆ˜ë£Œë¥¼ ë¹¼ê³ ë„ ì´ìµì´ ë‚¨ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”!' 
                },
                'observer': { 
                    icon: 'ğŸ‘ï¸', 
                    pattern: 'ê´€ì°°í˜• íˆ¬ìì',
                    info: 'ë§¤ë§¤ ì—†ì´ ì‹œì¥ì„ ê´€ì°°ë§Œ í•œ ìŠ¤íƒ€ì¼',
                    advice: '"ì•„ë¬´ê²ƒë„ ì•ˆ í•´ì„œ ìˆ˜ìµ?" - ì•„ë§ˆ ìš´ì´ ì¢‹ì•˜ì„ ê²ë‹ˆë‹¤. ë‹¤ìŒì—” í–‰ë™í•´ë³´ì„¸ìš”!' 
                }
            },
            // ì„±ê³µ (0% ~ +30%)
            'good': {
                'patient': { 
                    icon: 'ğŸ¯', 
                    pattern: 'ì•ˆì •í˜• íˆ¬ìì',
                    info: 'ê¾¸ì¤€í•œ ë§¤ë§¤ë¡œ ì•ˆì •ì  ìˆ˜ìµì„ ë‹¬ì„±',
                    advice: '"ê¾¸ì¤€í•¨ì´ ìŠ¹ë¶€ìˆ˜ë‹¤." - ì´ëŸ° íˆ¬ì ìŠ¤íƒ€ì¼ì´ì•¼ë§ë¡œ ì¥ê¸° ì„±ê³µì˜ ì—´ì‡ ì…ë‹ˆë‹¤!' 
                },
                'active': { 
                    icon: 'âš¡', 
                    pattern: 'ë°¸ëŸ°ìŠ¤ íŠ¸ë ˆì´ë”',
                    info: 'ì ì ˆí•œ ë§¤ë§¤ ë¹ˆë„ë¡œ ìˆ˜ìµ ì‹¤í˜„',
                    advice: '"ì ë‹¹í•¨ì˜ ë¯¸í•™!" - ë„ˆë¬´ ë§ì§€ë„ ì ì§€ë„ ì•Šì€ ë§¤ë§¤, í›Œë¥­í•œ ë°¸ëŸ°ìŠ¤ì…ë‹ˆë‹¤!' 
                },
                'emotional': { 
                    icon: 'ğŸ²', 
                    pattern: 'ê°ì • íˆ¬ìì',
                    info: 'ê°ì •ì  íŒë‹¨ìœ¼ë¡œë„ ì„ ë°©í•œ ì¼€ì´ìŠ¤',
                    advice: '"ì´ë²ˆì—” ìš´ì´ ì¢‹ì•˜ë„¤ìš”." - ê°ì •ë³´ë‹¤ëŠ” ì›ì¹™ì— ë”°ë¥¸ íˆ¬ìë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤!' 
                },
                'cautious': { 
                    icon: 'ğŸŒ', 
                    pattern: 'í˜„ëª…í•œ íˆ¬ìì',
                    info: 'ì‹ ì¤‘í•œ íŒë‹¨ìœ¼ë¡œ ì•ˆì •ì  ìˆ˜ìµ í™•ë³´',
                    advice: '"í˜„ëª…í•œ ì„ íƒì…ë‹ˆë‹¤!" - ë¦¬ìŠ¤í¬ ê´€ë¦¬ì™€ ìˆ˜ìµ ì¶”êµ¬ì˜ í›Œë¥­í•œ ê· í˜•ì„ ë³´ì—¬ì£¼ì…¨ë„¤ìš”!' 
                },
                'overactive': { 
                    icon: 'ğŸª', 
                    pattern: 'ê³¼ì‰ í™œë™ê°€',
                    info: 'ì¦ì€ ë§¤ë§¤ì—ë„ ë¶ˆêµ¬í•˜ê³  ìˆ˜ìµ ë‹¬ì„±',
                    advice: '"ë°”ì˜ê²Œ ì›€ì§ì—¬ì„œ ìˆ˜ìµ!" - í•˜ì§€ë§Œ ë” ì ì€ ë§¤ë§¤ë¡œë„ ê°™ì€ ìˆ˜ìµì´ ê°€ëŠ¥í–ˆì„ ê²ë‹ˆë‹¤!' 
                },
                'observer': { 
                    icon: 'ğŸ‘ï¸', 
                    pattern: 'í–‰ìš´ì˜ ê´€ì°°ì',
                    info: 'ë§¤ë§¤ ì—†ì´ë„ ì•½ê°„ì˜ ì´ìµ',
                    advice: '"ê°€ë§Œíˆ ìˆì–´ë„ ëˆì´?" - ë‹¤ìŒì—” ì ê·¹ì ì¸ íˆ¬ìë¡œ ë” ë§ì€ ê¸°íšŒë¥¼ ì¡ì•„ë³´ì„¸ìš”!' 
                }
            },
            // ë³´í†µ (-10% ~ 0%)
            'average': {
                'patient': { 
                    icon: 'ğŸ¯', 
                    pattern: 'ë³´ìˆ˜ì  íˆ¬ìì',
                    info: 'ì•ˆì „ ìš°ì„ ì˜ íˆ¬ì ìŠ¤íƒ€ì¼',
                    advice: '"ì•ˆì „ì´ ìµœê³ ì§€ë§Œ..." - ë•Œë¡œëŠ” ê³„ì‚°ëœ ìœ„í—˜ë„ í•„ìš”í•©ë‹ˆë‹¤. ê¸°íšŒë¥¼ ë†“ì¹˜ì§€ ë§ˆì„¸ìš”!' 
                },
                'active': { 
                    icon: 'âš¡', 
                    pattern: 'í˜¼ë€í˜• íŠ¸ë ˆì´ë”',
                    info: 'ë§ì€ ë§¤ë§¤ì—ë„ í° ì„±ê³¼ ì—†ìŒ',
                    advice: '"ë§¤ë§¤ë§Œ ë§ë‹¤ê³  ìˆ˜ìµì´ ì•„ë‹ˆë‹¤." - ì§ˆë³´ë‹¤ ì–‘ì— ì¹˜ì¤‘í•˜ê³  ìˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤!' 
                },
                'emotional': { 
                    icon: 'ğŸ²', 
                    pattern: 'ê°ì • ê¸°ë³µí˜•',
                    info: 'ê°ì •ì— ë”°ë¥¸ ë§¤ë§¤ë¡œ í‰ë²”í•œ ê²°ê³¼',
                    advice: '"ê°ì •ì€ íˆ¬ìì˜ ì ì…ë‹ˆë‹¤." - ëƒ‰ì •í•œ ë¶„ì„ê³¼ ì¸ë‚´ì‹¬ì„ ê¸°ë¥´ì‹œê¸° ë°”ëë‹ˆë‹¤!' 
                },
                'cautious': { 
                    icon: 'ğŸŒ', 
                    pattern: 'ë„ˆë¬´ ì‹ ì¤‘í•œ íˆ¬ìì',
                    info: 'ê³¼ë„í•œ ì‹ ì¤‘í•¨ìœ¼ë¡œ ê¸°íšŒ ë†“ì¹¨',
                    advice: '"ì‹ ì¤‘í•¨ë„ ê³¼í•˜ë©´ ë…!" - ì™„ë²½í•œ íƒ€ì´ë°ì„ ê¸°ë‹¤ë¦¬ë‹¤ ê¸°íšŒë¥¼ ë†“ì¹˜ì…¨ë„¤ìš”!' 
                },
                'overactive': { 
                    icon: 'ğŸª', 
                    pattern: 'ë¬´ì˜ë¯¸í•œ í™œë™ê°€',
                    info: 'ì¦ì€ ë§¤ë§¤ë¡œ ìˆ˜ìˆ˜ë£Œë§Œ ì¦ê°€',
                    advice: '"ì›€ì§ì„ì´ ë§ë‹¤ê³  ìˆ˜ìµì€ ì•„ë‹ˆë‹¤." - ë§¤ë§¤ ì „ì— í•œ ë²ˆ ë” ìƒê°í•´ë³´ì„¸ìš”!' 
                },
                'observer': { 
                    icon: 'ğŸ‘ï¸', 
                    pattern: 'ê¸°íšŒ ìƒì‹¤ì',
                    info: 'ì•„ë¬´ í–‰ë™ ì—†ì´ ê¸°íšŒë¥¼ ë†“ì¹¨',
                    advice: '"ê¸°íšŒëŠ” ì¤€ë¹„ëœ ìì—ê²Œë§Œ!" - ê´€ë§ë§Œ í•˜ì§€ ë§ê³  ìš©ê¸°ìˆëŠ” ê²°ì •ì„ ë‚´ë ¤ë³´ì„¸ìš”!' 
                }
            },
            // ì†ì‹¤ (-30% ~ -10%)
            'loss': {
                'patient': { 
                    icon: 'ğŸ¯', 
                    pattern: 'ë¶ˆìš´í•œ ì¸ë‚´ì',
                    info: 'ê¸°ë‹¤ë ¸ì§€ë§Œ ì‹œì¥ì´ ë°˜ëŒ€ë¡œ ì›€ì§ì„',
                    advice: '"ë•Œë¡œëŠ” ì†ì ˆë§¤ë„ ìš©ê¸°ë‹¤." - ì¸ë‚´ì‹¬ì€ ì¢‹ì§€ë§Œ, ì†ì‹¤ì„ ì œí•œí•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•©ë‹ˆë‹¤!' 
                },
                'active': { 
                    icon: 'âš¡', 
                    pattern: 'í˜¼ë€ ë§¤ë§¤ì',
                    info: 'ì¦ì€ ë§¤ë§¤ë¡œ ì†ì‹¤ í™•ëŒ€',
                    advice: '"ë§¤ë§¤í• ìˆ˜ë¡ ì†í•´!" - ë°©í–¥ì„± ì—†ëŠ” ë§¤ë§¤ê°€ ì†ì‹¤ì„ í‚¤ì› ìŠµë‹ˆë‹¤. ì „ëµì„ ì„¸ìš°ì„¸ìš”!' 
                },
                'emotional': { 
                    icon: 'ğŸ²', 
                    pattern: 'ê°ì •ì  ì†ì‹¤ì',
                    info: 'ê°ì •ì  ë§¤ë§¤ë¡œ í° ì†ì‹¤ ë°œìƒ',
                    advice: '"ê°ì •ì€ ì†ì‹¤ì˜ ì§€ë¦„ê¸¸." - ê³µí¬ì™€ ìš•ì‹¬ì„ ë²„ë¦¬ê³  ëƒ‰ì •í•˜ê²Œ íŒë‹¨í•˜ì„¸ìš”!' 
                },
                'cautious': { 
                    icon: 'ğŸŒ', 
                    pattern: 'íƒ€ì´ë° ì‹¤íŒ¨ì',
                    info: 'ì‹ ì¤‘í–ˆì§€ë§Œ ì˜ëª»ëœ íƒ€ì´ë°',
                    advice: '"ì‹ ì¤‘í•¨ë„ ë•Œë¥¼ ì•Œì•„ì•¼!" - ë¶„ì„ì€ ì¢‹ì•˜ì§€ë§Œ ì‹¤í–‰ íƒ€ì´ë°ì„ ì¬ê³ í•´ë³´ì„¸ìš”!' 
                },
                'overactive': { 
                    icon: 'ğŸª', 
                    pattern: 'ìë©¸í˜• íŠ¸ë ˆì´ë”',
                    info: 'ê³¼ë„í•œ ë§¤ë§¤ë¡œ ì‹¬ê°í•œ ì†ì‹¤',
                    advice: '"ê³¼ìœ ë¶ˆê¸‰!" - ë„ˆë¬´ ë§ì€ ë§¤ë§¤ê°€ ì˜¤íˆë ¤ ë…ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. íœ´ì‹ì´ í•„ìš”í•´ìš”!' 
                },
                'observer': { 
                    icon: 'ğŸ‘ï¸', 
                    pattern: 'ìˆ˜ë™ì  ì†ì‹¤ì',
                    info: 'ì•„ë¬´ í–‰ë™ ì—†ì´ ì†ì‹¤ ë°©ì¹˜',
                    advice: '"ì†ì‹¤ì„ ì§€ì¼œë§Œ ë´¤ë‚˜ìš”?" - ë•Œë¡œëŠ” ì ê·¹ì ì¸ ì†ì ˆë§¤ê°€ ë” í° ì†ì‹¤ì„ ë§‰ìŠµë‹ˆë‹¤!' 
                }
            },
            // í°ì†ì‹¤ (-30% ë¯¸ë§Œ)
            'disaster': {
                'patient': { 
                    icon: 'ğŸ¯', 
                    pattern: 'ê³ ì§‘ë¶ˆí†µ íˆ¬ìì',
                    info: 'ì˜ëª»ëœ íŒë‹¨ì„ ëê¹Œì§€ ê³ ì§‘',
                    advice: '"ê³ ì§‘ê³¼ ì¸ë‚´ëŠ” ë‹¤ë¥´ë‹¤!" - ì˜ëª»ë˜ì—ˆë‹¤ë©´ ë¹¨ë¦¬ ì¸ì •í•˜ê³  ë°©í–¥ì„ ë°”ê¾¸ì„¸ìš”!' 
                },
                'active': { 
                    icon: 'âš¡', 
                    pattern: 'ìí­í˜• íŠ¸ë ˆì´ë”',
                    info: 'ë§¤ë§¤í•  ë•Œë§ˆë‹¤ ì†ì‹¤ ëˆ„ì ',
                    advice: '"ë§¤ë§¤ëŠ” ë¬´ê¸°ê°€ ì•„ë‹ˆë¼ ë„êµ¬ë‹¤." - ì ì‹œ ë§¤ë§¤ë¥¼ ë©ˆì¶”ê³  ì „ëµì„ ì¬ì ê²€í•˜ì„¸ìš”!' 
                },
                'emotional': { 
                    icon: 'ğŸ²', 
                    pattern: 'ê°ì • í­ë°œí˜•',
                    info: 'ê°ì •ì  ë§¤ë§¤ë¡œ ìµœì•…ì˜ ê²°ê³¼',
                    advice: '"ê°ì • íˆ¬ìì˜ ì „í˜•ì  ê²°ë§." - íˆ¬ì ì „ì— ë§ˆìŒì„ ê°€ë¼ì•‰íˆê³  ì›ì¹™ì„ ì„¸ìš°ì„¸ìš”!' 
                },
                'cautious': { 
                    icon: 'ğŸŒ', 
                    pattern: 'ì˜ëª»ëœ ì‹ ì¤‘í•¨',
                    info: 'ì‹ ì¤‘í–ˆì§€ë§Œ ì™„ì „íˆ ì˜ëª»ëœ ë°©í–¥',
                    advice: '"ì‹ ì¤‘í•˜ê²Œ í‹€ë ¸ë„¤ìš”." - ë¶„ì„ ë°©ë²•ì„ ê·¼ë³¸ì ìœ¼ë¡œ ì¬ê²€í† í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤!' 
                },
                'overactive': { 
                    icon: 'ğŸª', 
                    pattern: 'ì¹´ì§€ë…¸í˜• íˆ¬ìì',
                    info: 'ë¬´ì°¨ë³„ ë§¤ë§¤ë¡œ ìµœì•…ì˜ ì†ì‹¤',
                    advice: '"ì´ê±´ íˆ¬ìê°€ ì•„ë‹ˆë¼ ë„ë°•!" - ë§¤ë§¤ë¥¼ ë©ˆì¶”ê³  íˆ¬ì ê³µë¶€ë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”!' 
                },
                'observer': { 
                    icon: 'ğŸ‘ï¸', 
                    pattern: 'ìµœì•…ì˜ ê´€ì°°ì',
                    info: 'ì•„ë¬´ê²ƒë„ ì•ˆí–ˆëŠ”ë° ìµœì•…ì˜ ê²°ê³¼',
                    advice: '"ê°€ë§Œíˆ ìˆì–´ë„ ì´ë ‡ê²Œ ìƒì„ ìˆ˜ ìˆë‹¤ë‹ˆ!" - ë‹¤ìŒì—” ì ê·¹ì ìœ¼ë¡œ ì†ì‹¤ì„ ë°©ì–´í•˜ì„¸ìš”!' 
                }
            }
        };
        
        // DOM ìš”ì†Œ
        const canvas = document.getElementById('chartCanvas');
        const ctx = canvas.getContext('2d');
        const currentMoneyEl = document.getElementById('currentMoney');
        const profitDisplayEl = document.getElementById('profitDisplay');
        const timeDisplayEl = document.getElementById('timeDisplay');
        const roundDisplayEl = document.getElementById('roundDisplay');
        const buyBtn = document.getElementById('buyBtn');
        const sellBtn = document.getElementById('sellBtn');
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const leaderboardScreen = document.getElementById('leaderboardScreen');
        
        // ë§¤ë§¤ ì¶”ì  í•¨ìˆ˜ë“¤
        function recordTrade(type, price, time) {
            gameState.trades.push({
                type: type, // 'buy' or 'sell'
                price: price,
                time: time,
                timeLeft: gameState.timeLeft
            });
        }
        
        function recordPrice(price, time, volatility) {
            gameState.priceHistory.push({
                price: price,
                time: time,
                volatility: volatility
            });
        }
        
        function calculateVolatility() {
            if (gameState.priceHistory.length < 2) return 0;
            const recent = gameState.priceHistory.slice(-10);
            let totalChange = 0;
            for (let i = 1; i < recent.length; i++) {
                totalChange += Math.abs(recent[i].price - recent[i-1].price);
            }
            return totalChange / recent.length;
        }
        
        // ë§¤ë§¤ íŒ¨í„´ ë¶„ì„
        function analyzePattern() {
            const trades = gameState.trades;
            const tradeCount = trades.length;
            
            if (tradeCount === 0) return 'observer';
            
            // ë§¤ë§¤ ë¹ˆë„ ê³„ì‚°
            if (tradeCount >= 5) {
                return 'overactive';
            }
            
            // í‰ê·  ë³´ìœ  ì‹œê°„ ê³„ì‚°
            let totalHoldTime = 0;
            let holdPeriods = 0;
            let currentPositionStart = null;
            
            for (let trade of trades) {
                if (trade.type === 'buy') {
                    currentPositionStart = 45 - trade.timeLeft;
                } else if (trade.type === 'sell' && currentPositionStart !== null) {
                    totalHoldTime += (45 - trade.timeLeft) - currentPositionStart;
                    holdPeriods++;
                    currentPositionStart = null;
                }
            }
            
            const avgHoldTime = holdPeriods > 0 ? totalHoldTime / holdPeriods : 0;
            
            // ê°ì •ì  ë§¤ë§¤ ì²´í¬ (ê³ ë³€ë™ì„± êµ¬ê°„ì—ì„œì˜ ë§¤ë§¤)
            let emotionalTrades = 0;
            for (let trade of trades) {
                const tradeTime = 45 - trade.timeLeft;
                const volatility = getVolatilityAtTime(tradeTime);
                if (volatility > 2) {
                    emotionalTrades++;
                }
            }
            
            const emotionalRatio = emotionalTrades / tradeCount;
            
            // íŒ¨í„´ ê²°ì •
            if (emotionalRatio > 0.6) return 'emotional';
            if (tradeCount <= 2 && avgHoldTime > 20) return 'patient';
            if (tradeCount >= 3 && avgHoldTime < 15) return 'active';
            if (tradeCount <= 2 && avgHoldTime < 20) return 'cautious';
            
            return 'cautious';
        }
        
        function getVolatilityAtTime(time) {
            // í•´ë‹¹ ì‹œê°„ì˜ ë³€ë™ì„± ê³„ì‚° (ê°„ë‹¨í•œ ê·¼ì‚¬ì¹˜)
            const priceAtTime = gameState.priceHistory.find(p => Math.abs(p.time - time) < 1);
            return priceAtTime ? priceAtTime.volatility : 0;
        }
        
        // ìˆ˜ìµë¥  êµ¬ê°„ ë¶„ì„
        function analyzePerformance(profitPercent) {
            if (profitPercent >= 30) return 'excellent';
            if (profitPercent >= 0) return 'good';
            if (profitPercent >= -10) return 'average';
            if (profitPercent >= -30) return 'loss';
            return 'disaster';
        }
        
        // íˆ¬ì ì¡°ì–¸ í‘œì‹œ
        function showAdvice(profitPercent) {
            const performance = analyzePerformance(profitPercent);
            const pattern = analyzePattern();
            const advice = adviceMatrix[performance][pattern];
            
            document.getElementById('patternIcon').textContent = advice.icon;
            document.getElementById('patternText').textContent = advice.pattern;
            document.getElementById('patternInfo').textContent = advice.info;
            document.getElementById('adviceText').textContent = advice.advice;
            
            document.getElementById('adviceSection').style.display = 'block';
        }
        
        // ë¦¬ë”ë³´ë“œ ê´€ë¦¬
        function getLeaderboard() {
            const saved = localStorage.getItem('chartGameLeaderboard');
            return saved ? JSON.parse(saved) : [];
        }
        
        function saveLeaderboard(leaderboard) {
            localStorage.setItem('chartGameLeaderboard', JSON.stringify(leaderboard));
        }
        
        function addToLeaderboard(name, score) {
            const leaderboard = getLeaderboard();
            leaderboard.push({ name: name.toUpperCase(), score: Math.round(score) });
            leaderboard.sort((a, b) => b.score - a.score);
            const top10 = leaderboard.slice(0, 10);
            saveLeaderboard(top10);
            return top10;
        }
        
        function isHighScore(score) {
            const leaderboard = getLeaderboard();
            return leaderboard.length < 10 || score > (leaderboard[9]?.score || 0);
        }
        
        function showLeaderboard() {
            const leaderboard = getLeaderboard();
            const listEl = document.getElementById('leaderboardList');
            
            if (leaderboard.length === 0) {
                listEl.innerHTML = '<p style="text-align: center; color: #666;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            } else {
                listEl.innerHTML = leaderboard.map((entry, index) => {
                    const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                    const medal = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : '';
                    return `
                        <div class="leaderboard-item">
                            <span class="rank ${rankClass}">${medal}${index + 1}</span>
                            <span class="player-name">${entry.name}</span>
                            <span class="score">$${entry.score.toLocaleString()}</span>
                        </div>
                    `;
                }).join('');
            }
            
            leaderboardScreen.style.display = 'flex';
        }
        
        function hideLeaderboard() {
            leaderboardScreen.style.display = 'none';
        }
        
        function restartFromLeaderboard() {
            hideLeaderboard();
            startScreen.style.display = 'block';
            gameScreen.style.display = 'none';
        }
        
        function clearLeaderboard() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('chartGameLeaderboard');
                showLeaderboard();
            }
        }
        
        // Canvas í¬ê¸° ì„¤ì •
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = container.clientHeight - 40;
        }
        
        // ê²Œì„ ì‹œì‘
        function startNewGame() {
            window.tickCount = 0;
            gameState = {
                cash: 10000,
                stocks: 0,
                stockPrice: 100,
                timeLeft: 45,
                round: gameState.round,
                gameRunning: true,
                chartData: [{price: 100, time: 0}],
                maxTime: 45,
                currentMinPrice: 90,
                currentMaxPrice: 110,
                targetMinPrice: 90,
                targetMaxPrice: 110,
                trades: [],
                priceHistory: [{price: 100, time: 0, volatility: 0}],
                currentPosition: 'cash'
            };
            
            startScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            gameOverScreen.style.display = 'none';
            updateUI();
            resizeCanvas();
            
            // ê²Œì„ íƒ€ì´ë¨¸ ì‹œì‘ (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ 100msë§ˆë‹¤ ì—…ë°ì´íŠ¸)
            const gameTimer = setInterval(() => {
                if (!gameState.gameRunning) {
                    clearInterval(gameTimer);
                    return;
                }
                
                window.tickCount++;
                
                // 100msë§ˆë‹¤ ì‘ì€ ì£¼ê°€ ë³€ë™
                const smallChange = (Math.random() - 0.5) * 1.2;
                gameState.stockPrice = Math.max(10, gameState.stockPrice + smallChange);
                
                // ê°€ê²© ê¸°ë¡ (ë³€ë™ì„± ê³„ì‚°ìš©)
                const volatility = calculateVolatility();
                recordPrice(gameState.stockPrice, gameState.maxTime - gameState.timeLeft + (window.tickCount % 10) * 0.1, volatility);
                
                // ì°¨íŠ¸ ìŠ¤ì¼€ì¼ ë¶€ë“œëŸ¬ìš´ ì—…ë°ì´íŠ¸
                updateChartScale();
                
                // 1ì´ˆë§ˆë‹¤ (10í‹±ë§ˆë‹¤) ì‹œê°„ ê°ì†Œ ë° ì°¨íŠ¸ ë°ì´í„° ì¶”ê°€
                if (window.tickCount % 10 === 0) {
                    gameState.timeLeft--;
                    gameState.chartData.push({
                        price: gameState.stockPrice,
                        time: gameState.maxTime - gameState.timeLeft
                    });
                }
                
                updateUI();
                drawChart();
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 100);
        }
        
        // ì°¨íŠ¸ ìŠ¤ì¼€ì¼ ë¶€ë“œëŸ¬ìš´ ì—…ë°ì´íŠ¸
        function updateChartScale() {
            const prices = [...gameState.chartData.map(d => d.price), gameState.stockPrice];
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice;
            
            // í˜„ì¬ ìŠ¤ì¼€ì¼ì—ì„œ ë²—ì–´ë‚˜ëŠ” ì •ë„ ì²´í¬ (15% ì„ê³„ì )
            const currentRange = gameState.currentMaxPrice - gameState.currentMinPrice;
            const minThreshold = gameState.currentMinPrice + currentRange * 0.15;
            const maxThreshold = gameState.currentMaxPrice - currentRange * 0.15;
            
            // ì„ê³„ì ì„ ë„˜ìœ¼ë©´ ìƒˆë¡œìš´ íƒ€ê²Ÿ ìŠ¤ì¼€ì¼ ì„¤ì •
            if (minPrice < minThreshold || maxPrice > maxThreshold) {
                const padding = Math.max(priceRange * 0.1, 5);
                gameState.targetMinPrice = minPrice - padding;
                gameState.targetMaxPrice = maxPrice + padding;
            }
            
            // í˜„ì¬ ìŠ¤ì¼€ì¼ì„ íƒ€ê²Ÿìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™ (5% ë¹„ìœ¨)
            const lerpRate = 0.05;
            gameState.currentMinPrice += (gameState.targetMinPrice - gameState.currentMinPrice) * lerpRate;
            gameState.currentMaxPrice += (gameState.targetMaxPrice - gameState.currentMaxPrice) * lerpRate;
        }
        
        // ì‹¤ì‹œê°„ ì°¨íŠ¸ ë°ì´í„° (ë§¤ 100msë§ˆë‹¤ ì—…ë°ì´íŠ¸)
        let realtimeData = [];
        
        // ì°¨íŠ¸ ê·¸ë¦¬ê¸° (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ë²„ì „)
        function drawChart() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ (í˜„ì¬ ê°€ê²©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶”ê°€)
            const currentTime = gameState.maxTime - gameState.timeLeft + (window.tickCount % 10) * 0.1;
            realtimeData = [...gameState.chartData, {price: gameState.stockPrice, time: currentTime}];
            
            if (realtimeData.length < 2) return;
            
            const padding = 20;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            
            // ë¶€ë“œëŸ¬ìš´ ìŠ¤ì¼€ì¼ ì‚¬ìš©
            const priceRange = gameState.currentMaxPrice - gameState.currentMinPrice;
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸° (ë¶€ë“œëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜)
            const gradient = ctx.createLinearGradient(0, padding, 0, canvas.height - padding);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.05)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0.1)');
            
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // ë¶€ë“œëŸ¬ìš´ ê³¡ì„  ë¼ì¸ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#4ade80';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.beginPath();
            
            // ë² ì§€ì–´ ê³¡ì„ ì„ ì‚¬ìš©í•œ ë¶€ë“œëŸ¬ìš´ ë¼ì¸
            realtimeData.forEach((point, index) => {
                const x = padding + (chartWidth / gameState.maxTime) * point.time;
                const y = padding + chartHeight - ((point.price - gameState.currentMinPrice) / priceRange) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else if (index === 1) {
                    ctx.lineTo(x, y);
                } else {
                    // ë¶€ë“œëŸ¬ìš´ ê³¡ì„ ì„ ìœ„í•œ ë² ì§€ì–´ ê³¡ì„ 
                    const prevPoint = realtimeData[index - 1];
                    const prevX = padding + (chartWidth / gameState.maxTime) * prevPoint.time;
                    const prevY = padding + chartHeight - ((prevPoint.price - gameState.currentMinPrice) / priceRange) * chartHeight;
                    
                    const cpX = (prevX + x) / 2;
                    ctx.quadraticCurveTo(cpX, prevY, x, y);
                }
            });
            
            ctx.stroke();
            
            // í˜„ì¬ ê°€ê²© í¬ì¸íŠ¸ (í„ìŠ¤ íš¨ê³¼)
            if (realtimeData.length > 0) {
                const lastPoint = realtimeData[realtimeData.length - 1];
                const x = padding + (chartWidth / gameState.maxTime) * lastPoint.time;
                const y = padding + chartHeight - ((lastPoint.price - gameState.currentMinPrice) / priceRange) * chartHeight;
                
                // í„ìŠ¤ íš¨ê³¼ë¥¼ ìœ„í•œ ì• ë‹ˆë©”ì´ì…˜
                const pulseSize = 3 + Math.sin(Date.now() * 0.01) * 2;
                
                // ì™¸ê³½ ì› (í„ìŠ¤)
                ctx.fillStyle = 'rgba(74, 222, 128, 0.3)';
                ctx.beginPath();
                ctx.arc(x, y, pulseSize + 3, 0, Math.PI * 2);
                ctx.fill();
                
                // ë‚´ë¶€ ì›
                ctx.fillStyle = '#4ade80';
                ctx.beginPath();
                ctx.arc(x, y, pulseSize, 0, Math.PI * 2);
                ctx.fill();
                
                // ê°€ê²© í…ìŠ¤íŠ¸ (ê·¸ë¦¼ì íš¨ê³¼)
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 4;
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px -apple-system';
                ctx.fillText(`$${lastPoint.price.toFixed(1)}`, x + 15, y - 10);
                ctx.shadowBlur = 0;
            }
        }
        
        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            const totalValue = gameState.cash + (gameState.stocks * gameState.stockPrice);
            const profit = ((totalValue - 10000) / 10000) * 100;
            
            currentMoneyEl.textContent = Math.round(totalValue);
            
            profitDisplayEl.textContent = `${profit >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${profit.toFixed(1)}%`;
            profitDisplayEl.className = `profit ${profit >= 0 ? 'positive' : 'negative'}`;
            
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            timeDisplayEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            roundDisplayEl.textContent = gameState.round;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            buyBtn.disabled = gameState.cash < gameState.stockPrice || !gameState.gameRunning || gameState.stocks > 0;
            sellBtn.disabled = gameState.stocks === 0 || !gameState.gameRunning;
        }
        
        // ë§¤ìˆ˜ í•¨ìˆ˜
        function buyStock() {
            if (gameState.cash >= gameState.stockPrice && gameState.gameRunning && gameState.stocks === 0) {
                const stocksToBuy = Math.floor(gameState.cash / gameState.stockPrice);
                gameState.stocks += stocksToBuy;
                gameState.cash -= stocksToBuy * gameState.stockPrice;
                gameState.currentPosition = 'stocks';
                
                // ë§¤ë§¤ ê¸°ë¡
                recordTrade('buy', gameState.stockPrice, gameState.maxTime - gameState.timeLeft);
                
                updateUI();
            }
        }
        
        // ë§¤ë„ í•¨ìˆ˜
        function sellStock() {
            if (gameState.stocks > 0 && gameState.gameRunning) {
                gameState.cash += gameState.stocks * gameState.stockPrice;
                gameState.stocks = 0;
                gameState.currentPosition = 'cash';
                
                // ë§¤ë§¤ ê¸°ë¡
                recordTrade('sell', gameState.stockPrice, gameState.maxTime - gameState.timeLeft);
                
                updateUI();
            }
        }
        
        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            gameState.gameRunning = false;
            
            const totalValue = gameState.cash + (gameState.stocks * gameState.stockPrice);
            const profit = totalValue - 10000;
            const profitPercent = (profit / 10000) * 100;
            
            let message = '';
            if (profitPercent > 50) {
                message = `ğŸ‰ Amazing! +${profitPercent.toFixed(1)}%`;
            } else if (profitPercent > 20) {
                message = `ğŸ”¥ Excellent! +${profitPercent.toFixed(1)}%`;
            } else if (profitPercent > 0) {
                message = `ğŸ‘ Good job! +${profitPercent.toFixed(1)}%`;
            } else if (profitPercent > -10) {
                message = `ğŸ˜ Not bad! ${profitPercent.toFixed(1)}%`;
            } else {
                message = `ğŸ˜… Try again! ${profitPercent.toFixed(1)}%`;
            }
            
            document.getElementById('finalResult').textContent = message;
            
            // íˆ¬ì ì¡°ì–¸ í‘œì‹œ
            showAdvice(profitPercent);
            
            // ë¦¬ë”ë³´ë“œ ì²´í¬
            if (isHighScore(totalValue)) {
                document.getElementById('newRecordSection').style.display = 'block';
                document.getElementById('playerNameInput').value = '';
                setTimeout(() => document.getElementById('playerNameInput').focus(), 100);
            } else {
                document.getElementById('newRecordSection').style.display = 'none';
            }
            
            gameState.round++;
            gameOverScreen.style.display = 'flex';
        }
        
        // ê²Œì„ ì˜¤ë²„ ì²˜ë¦¬ (ê°œì„ ëœ í”Œë¡œìš°)
        function handleGameOver() {
            const newRecordSection = document.getElementById('newRecordSection');
            const nameInput = document.getElementById('playerNameInput');
            
            // ë¦¬ë”ë³´ë“œ ì§„ì… ì‹œ ì´ë¦„ ì…ë ¥ ì²´í¬
            if (newRecordSection.style.display !== 'none') {
                const playerName = nameInput.value.trim();
                if (playerName.length !== 3) {
                    alert('ì˜ë¬¸ 3ê¸€ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    nameInput.focus();
                    return;
                }
                
                const totalValue = gameState.cash + (gameState.stocks * gameState.stockPrice);
                addToLeaderboard(playerName, totalValue);
            }
            
            // ê²Œì„ ì˜¤ë²„ í™”ë©´ ë‹«ê³  ë¦¬ë”ë³´ë“œ í‘œì‹œ
            gameOverScreen.style.display = 'none';
            showLeaderboard();
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        buyBtn.addEventListener('click', buyStock);
        sellBtn.addEventListener('click', sellStock);
        window.addEventListener('resize', resizeCanvas);
        
        // ì—”í„°í‚¤ë¡œ ì´ë¦„ ì…ë ¥ ì™„ë£Œ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('newRecordSection').style.display !== 'none') {
                handleGameOver();
            }
        });
        
        // ì´ë¦„ ì…ë ¥ í•„í„°ë§ (ì˜ë¬¸ë§Œ)
        document.getElementById('playerNameInput').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^A-Za-z]/g, '').toUpperCase();
        });
        
        // ì´ˆê¸°í™”
        resizeCanvas();
    </script>
</body>
</html>